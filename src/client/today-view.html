<link rel="import" href="common-styles.html">
<link rel="import" href="today-exercise-card.html">

<dom-module id="today-view">

  <style>

  :host{
    position: relative;
    display: inline-block;
    padding: 12px;
    width: 100%;
    height: 100%;
  }

  </style>
  
  <template>
    
    <style include="common-styles"></style>

    <!-- TODO: fix image, need more coffee -->
    <div class="layout horizontal wrap">
       <template is="dom-repeat" items="{{exercises}}">
          <today-exercise-card exercise="{{item}}"
            on-cow="onSaveExercise"></today-exercise-card>
        </template>
    </div>

    <iron-ajax
      id="workoutTodayService"
      url="http://localhost:5000/api/workouts/today"
      handle-as="json"
      content-type="application/json"
      method="GET"
      on-response="onWorkoutTodaySuccess"
      on-error="onWorkoutTodayError"
      debounce-duration="300"></iron-ajax>

  </template>

  <script>

    Polymer({
      is: "today-view",

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {

        exercises: {
          type: Array,
          value: []
        }
      },

      attached: function()
      {
        var workoutTodayService = this.$.workoutTodayService;
        if(window.sessionStorage.token)
        {
          workoutTodayService.headers = {"Authorization": "Bearer " + window.sessionStorage.token};
        }
        workoutTodayService.generateRequest();
      },

      getExerciseIcon: function(exerciseName)
      {
        var image = "";
        switch(exerciseName.toLowerCase())
        {
          case 'squat':
            image = 'images/squat.jpg';
            break;

          case 'deadlift':
            image = 'images/deadlift.jpg';
            break;

          case 'bench press':
            image = 'images/bench-press.png';
            break;
        }
        // console.log("getExerciseIcon, image:", image);
        return image;
      },

      onWorkoutTodaySuccess: function(event)
      {
        // console.log("today-view::onWorkoutTodaySuccess, response:", event.detail.response);
        var me = this;
        this.exercises = _.map(event.detail.response, function(exercise)
        {
          exercise.imageURL = me.getExerciseIcon(exercise.name);
          return exercise;
        });
      },

      onWorkoutTodayError: function(event)
      {
        console.error("today-view::onWorkoutTodayError", event.detail.error);
      }



    });
  </script>

</dom-module>