<link rel="import" href="common-styles.html">
<link rel="import" href="today-exercise-card.html">

<dom-module id="today-view">

  <style>

  :host{
    position: relative;
    display: inline-block;
    padding: 12px;
  }

  </style>
  
  <template>
    
    <style include="common-styles"></style>

    <!-- TODO: fix image, need more coffee -->
    <div class="layout vertical">
       <template is="dom-repeat" items="{{exercises}}">
          <today-exercise-card exercise-title="{{item.name}}"
            exercise-goal="{{item.goal}}"
            exercise-image-url="images/bench-press.png"
            on-cow="onExerciseTapped"></today-exercise-card>
        </template>
    </div>

    <iron-ajax
      auto
      id="workoutTodayService"
      url="http://localhost:5000/api/workouts/today"
      handle-as="json"
      content-type="application/json"
      method="GET"
      on-response="handleResponse"
      debounce-duration="300"></iron-ajax>

  </template>

  <script>

    Polymer({
      is: "today-view",

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {

        exercises: {
          type: Array,
          value: []
        }
      },

      getExerciseIcon: function(exerciseName)
      {
        var image = "";
        switch(exerciseName.toLowerCase())
        {
          case 'squat':
            image = 'images/squat.jpg';
            break;

          case 'deadlift':
            image = 'images/deadlift.jpg';
            break;

          case 'bench press':
            image = 'images/bench-press.png';
            break;
        }
        console.log("getExerciseIcon, image:", image);
        return image;
      },

      handleResponse: function(response)
      {
        console.log("today-view::handleResponse, response:", response.detail.response);
        var todaysWorkout = response.detail.response;
        var monday = new Date();
        monday.setDate(monday.getDate() + 1);
        var workout = this.getExercisesForDate(todaysWorkout, monday);
        this.exercises = workout.exercises;
      },

      getExercisesForDate: function(workouts, date)
      {
          return _.find(workouts, function(workout)
          {
              return _.includes(workout.days, date.getDay());
          });
      },

      onExerciseTapped: function(event, detail)
      {
        console.log("today-view::onExerciseTapped");
        this.fire('selected', detail);
      }

    });
  </script>

</dom-module>